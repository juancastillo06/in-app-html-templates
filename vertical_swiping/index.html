<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OneSignal Vertical Carousel</title>

<style>
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    background: #0b1220;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color: #fff;
  }

  .carousel{
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #0b1220;
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;

    /* optional: avoids content underlapping system bars on some webviews */
    padding-top: env(safe-area-inset-top, 0px);
    padding-right: env(safe-area-inset-right, 0px);
  }

  .track{
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    transform: translate3d(0,0,0);
    transition: transform 320ms cubic-bezier(.2,.9,.2,1);
    will-change: transform;
  }

  .slide{
    flex: 0 0 100%;
    height: 100%;
    width: 100%;
    padding: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card{
    width: 100%;
    max-width: 520px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 20px;
    padding: 24px;
  }

  h2 { margin: 0 0 10px; font-size: 22px; }
  p  { margin: 0 0 16px; color: rgba(255,255,255,0.75); line-height: 1.5; }

  .actions{
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  button{
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: #fff;
    padding: 10px 14px;
    font-weight: 600;
    cursor: pointer;
  }

  .primary{
    background: rgba(82,97,255,.6);
    border-color: rgba(82,97,255,.8);
  }

  /* Bigger, safer tap target for Android */
  .close{
    position: absolute;
    z-index: 10;

    /* SAFE AREA + extra padding so it's never "too high" */
    top: calc(env(safe-area-inset-top, 0px) + 12px);
    right: calc(env(safe-area-inset-right, 0px) + 12px);

    width: 48px;
    height: 48px;
    padding: 0;

    display: grid;
    place-items: center;

    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.10);
    font-size: 18px;
    line-height: 1;
  }

  .nav{
    position: absolute;
    right: calc(env(safe-area-inset-right, 0px) + 16px);
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 10;
  }

  .dot{
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(255,255,255,0.3);
    border: none;
    padding: 0;
    cursor: pointer;
  }

  .dot[aria-current="true"]{
    height: 26px;
    background: rgba(82,97,255,.8);
  }

  /* Hidden but real OneSignal close button */
  #close-button {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0,0,0,0);
    white-space: nowrap;
    border: 0;
  }
</style>
</head>

<body>
<div class="carousel" id="carousel">

  <!-- Real OneSignal close button (Android-safe) -->
  <button id="close-button" data-onesignal-unique-label="iam-close">Close</button>

  <!-- Visible X (safe-area positioned, big tap target) -->
  <button class="close" id="closeBtn" type="button" aria-label="Close">âœ•</button>

  <div class="track" id="track">
    <section class="slide">
      <div class="card">
        <h2>Welcome ðŸ‘‹</h2>
        <p>Swipe up to continue. Each slide is a custom HTML section.</p>
        <div class="actions">
          <button class="primary" type="button" data-next>Continue</button>
        </div>
      </div>
    </section>

    <section class="slide">
      <div class="card">
        <h2>Feature Highlight âœ¨</h2>
        <p>Vertical swipe + dots + buttons.</p>
        <div class="actions">
          <button class="primary" type="button" data-next>Next</button>
          <button type="button" data-prev>Back</button>
        </div>
      </div>
    </section>

    <section class="slide">
      <div class="card">
        <h2>All Set âœ…</h2>
        <p>Done / X will dismiss the IAM properly.</p>
        <div class="actions">
          <button class="primary" type="button" id="doneBtn">Done</button>
          <button type="button" data-prev>Back</button>
        </div>
      </div>
    </section>
  </div>

  <div class="nav" id="dots" aria-label="Slide dots"></div>
</div>

<script>
(function () {
  const carousel = document.getElementById('carousel');
  const track = document.getElementById('track');
  const slides = Array.from(track.querySelectorAll('.slide'));
  const dots = document.getElementById('dots');

  let index = 0;
  let height = 1;
  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

  function measure() {
    height = carousel.getBoundingClientRect().height || 1;
    snap(index, false);
  }

  function snap(i, animate = true) {
    index = clamp(i, 0, slides.length - 1);
    track.style.transition = animate ? '' : 'none';
    track.style.transform = `translate3d(0, ${-index * height}px, 0)`;
    updateDots();
    if (!animate) requestAnimationFrame(() => (track.style.transition = ''));
  }

  function next() { snap(index + 1); }
  function prev() { snap(index - 1); }

  slides.forEach((_, i) => {
    const d = document.createElement('button');
    d.className = 'dot';
    d.type = 'button';
    d.setAttribute('aria-label', `Go to slide ${i + 1}`);
    d.onclick = () => snap(i);
    dots.appendChild(d);
  });

  function updateDots() {
    Array.from(dots.children).forEach((d, i) => {
      d.setAttribute('aria-current', i === index ? 'true' : 'false');
    });
  }

  document.addEventListener('click', (e) => {
    if (e.target.matches('[data-next]')) next();
    if (e.target.matches('[data-prev]')) prev();
  });

  // Swipe (Pointer + Touch fallback)
  let startY = 0, currentY = 0, dragging = false, startTranslate = 0;

  function getTranslateY() {
    const m = (track.style.transform || '').match(/translate3d\(0,\s*([-0-9.]+)px/);
    return m ? parseFloat(m[1]) : 0;
  }

  function beginDrag(y) {
    dragging = true;
    startY = y;
    currentY = y;
    startTranslate = getTranslateY();
    track.style.transition = 'none';
  }

  function moveDrag(y) {
    if (!dragging) return;
    currentY = y;
    const dy = currentY - startY;

    const atStart = index === 0 && dy > 0;
    const atEnd = index === slides.length - 1 && dy < 0;
    const resistance = (atStart || atEnd) ? 0.35 : 1;

    track.style.transform = `translate3d(0, ${startTranslate + dy * resistance}px, 0)`;
  }

  function endDrag() {
    if (!dragging) return;
    dragging = false;

    const dy = currentY - startY;
    const threshold = Math.min(90, height * 0.22);

    track.style.transition = '';
    if (dy < -threshold) return next();
    if (dy > threshold) return prev();
    snap(index);
  }

  carousel.addEventListener('pointerdown', (e) => {
    if (e.target.closest('button, a, input, textarea, select, label')) return;
    beginDrag(e.clientY);
    carousel.setPointerCapture?.(e.pointerId);
  });
  carousel.addEventListener('pointermove', (e) => moveDrag(e.clientY));
  carousel.addEventListener('pointerup', endDrag);
  carousel.addEventListener('pointercancel', endDrag);

  carousel.addEventListener('touchstart', (e) => {
    if (e.target.closest('button, a, input, textarea, select, label')) return;
    if (e.touches && e.touches.length) beginDrag(e.touches[0].clientY);
  }, { passive: true });

  carousel.addEventListener('touchmove', (e) => {
    if (!dragging) return;
    e.preventDefault();
    if (e.touches && e.touches.length) moveDrag(e.touches[0].clientY);
  }, { passive: false });

  carousel.addEventListener('touchend', endDrag, { passive: true });
  carousel.addEventListener('touchcancel', endDrag, { passive: true });

  new ResizeObserver(measure).observe(carousel);

  // OneSignal close: bind to the real OneSignal-labeled button
  const closeButton = document.getElementById("close-button");
  closeButton.addEventListener("click", function(e) {
    const api = window.OneSignalIamApi || (typeof OneSignalIamApi !== "undefined" ? OneSignalIamApi : null);
    if (api && typeof api.close === "function") api.close(e);
    else carousel.style.display = "none"; // preview fallback
  });

  // X and Done trigger the OneSignal close button click (Android-safe)
  document.getElementById("closeBtn").addEventListener("click", () => closeButton.click());
  document.getElementById("doneBtn").addEventListener("click", () => closeButton.click());

  // Init
  measure();
  updateDots();
})();
</script>
</body>
</html>

